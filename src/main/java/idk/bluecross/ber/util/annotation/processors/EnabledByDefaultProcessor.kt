package idk.bluecross.ber.util.annotation.processors

import idk.bluecross.ber.api.module.IModule
import idk.bluecross.ber.util.annotation.annotations.EnabledByDefault
import idk.bluecross.ber.util.annotation.processors.AutoInitProcessor.IProcessor
import idk.bluecross.ber.util.annotation.processors.AutoInitProcessor.InitProcessor
import org.reflections.Reflections

@InitProcessor
object EnabledByDefaultProcessor : IProcessor {
    override fun process() {
        Reflections(Reflections("idk.bluecross.ber.module.modules").getSubTypesOf(IModule::class.java))
                .getTypesAnnotatedWith(EnabledByDefault::class.java).forEach {
            with(it.kotlin) {
                if (!this.isAbstract) {
                    (this.objectInstance as? IModule)?.enable()
                            ?: throw RuntimeException("Cannot do `class.objectInstance as? AbstractModule` for class, annotated with @EnabledByDefault")
                }
            }

        }
    }
}