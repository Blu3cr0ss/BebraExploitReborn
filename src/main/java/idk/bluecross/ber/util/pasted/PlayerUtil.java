package idk.bluecross.ber.util.pasted;


import com.mojang.authlib.GameProfile;
import idk.bluecross.ber.util.interfaces.Globals;
import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.entity.Entity;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.potion.PotionEffect;
import net.minecraft.world.World;

import java.util.HashMap;
import java.util.Map;
import java.util.UUID;
import java.util.concurrent.ThreadLocalRandom;
import java.util.function.BiFunction;


public class PlayerUtil implements Globals {
    public static final Map<Integer, EntityOtherPlayerMP> FAKE_PLAYERS =
            new HashMap<>();

    public static EntityOtherPlayerMP createFakePlayerAndAddToWorld(GameProfile profile) {
        return createFakePlayerAndAddToWorld(profile, EntityOtherPlayerMP::new);
    }

    public static EntityOtherPlayerMP createFakePlayerAndAddToWorld(GameProfile profile, BiFunction<World, GameProfile, EntityOtherPlayerMP> create) {
        EntityOtherPlayerMP fakePlayer = createFakePlayer(profile, create);
        int randomID = -1000;
        while (FAKE_PLAYERS.containsKey(randomID)
                || mc.world.getEntityByID(randomID) != null) {
            randomID = ThreadLocalRandom.current().nextInt(-100000, -100);
        }

        FAKE_PLAYERS.put(randomID, fakePlayer);
        mc.world.addEntityToWorld(randomID, fakePlayer);
        return fakePlayer;
    }

    public static EntityOtherPlayerMP createFakePlayer(GameProfile profile, BiFunction<World, GameProfile, EntityOtherPlayerMP> create)
    {
        EntityOtherPlayerMP fakePlayer = create.apply(mc.world, profile);

        fakePlayer.setPrimaryHand(mc.player.getPrimaryHand());
        fakePlayer.inventory = mc.player.inventory;
        fakePlayer.inventoryContainer = mc.player.inventoryContainer;
        fakePlayer.setPositionAndRotation(mc.player.posX, mc.player.getEntityBoundingBox().minY, mc.player.posZ, mc.player.rotationYaw, mc.player.rotationPitch);
        fakePlayer.rotationYawHead = mc.player.rotationYawHead;
        fakePlayer.onGround = mc.player.onGround;
        fakePlayer.setSneaking(mc.player.isSneaking());
        fakePlayer.setHealth(mc.player.getHealth());
        fakePlayer.setAbsorptionAmount(mc.player.getAbsorptionAmount());

        for (PotionEffect effect : mc.player.getActivePotionEffects())
        {
            fakePlayer.addPotionEffect(effect);
        }

        return fakePlayer;
    }

    public static EntityPlayer copyPlayer(EntityPlayer playerIn) {
        return copyPlayer(playerIn, true);
    }

    public static EntityPlayer copyPlayer(EntityPlayer playerIn, boolean animations) {
        int count = playerIn.getItemInUseCount();

        EntityPlayer copy = new EntityPlayer(mc.world, new GameProfile(UUID.randomUUID(), playerIn.getName())) {
            @Override public boolean isSpectator() {
                return false;
            }

            @Override public boolean isCreative() {
                return false;
            }
        };
        if (animations) {
            copy.setSneaking(playerIn.isSneaking());
            copy.swingProgress = playerIn.swingProgress;
            copy.limbSwing = playerIn.limbSwing;
            copy.limbSwingAmount = playerIn.prevLimbSwingAmount;
            copy.inventory.copyInventory(playerIn.inventory);
        }
        copy.setPrimaryHand(playerIn.getPrimaryHand());
        copy.ticksExisted = playerIn.ticksExisted;
        copy.setEntityId(playerIn.getEntityId());
        copy.copyLocationAndAnglesFrom(playerIn);
        return copy;
    }

    /**
     * Removes the given fakeplayer.
     *
     * @param fakePlayer the fakeplayer to remove.
     */
    public static void removeFakePlayer(EntityOtherPlayerMP fakePlayer) {
        mc.addScheduledTask(() -> {
            FAKE_PLAYERS.remove(fakePlayer.getEntityId());
            fakePlayer.isDead = true; // setDead might be overridden
            if (mc.world != null) {
                mc.world.removeEntity(fakePlayer);
            }
        });
    }

    public static boolean isFakePlayer(Entity entity) {
        return entity != null && FAKE_PLAYERS.containsKey(entity.getEntityId());
    }

    public static boolean isOtherFakePlayer(Entity entity) {
        return entity != null && entity.getEntityId() < 0;
    }

    public static boolean isCreative(EntityPlayer player) {
        return player != null
                && (player.isCreative()
                || player.capabilities.isCreativeMode);
    }



}