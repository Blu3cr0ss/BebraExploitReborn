package idk.bluecross.ber.impl.module.ChatSettings

import idk.bluecross.ber.impl.module.Module
import idk.bluecross.ber.impl.setting.settings.StringSetting
import idk.bluecross.ber.util.ChatUtil
import idk.bluecross.ber.util.annotation.annotations.EnabledByDefault
import idk.bluecross.ber.impl.event.PacketSendEvent
import net.minecraft.network.play.client.CPacketChatMessage
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent

@EnabledByDefault
object ChatSettings : Module("Настройки в чате") {
    var prefix by setting("Prefix", "?")

    @SubscribeEvent
    fun chatMessage(e: PacketSendEvent) {
        if (e.packet is CPacketChatMessage) {
//            println(prefix)
            val msg = (e.packet as CPacketChatMessage).message.toLowerCase()
            if (msg.startsWith(prefix)) {
                val msgSplit = msg.removePrefix("?").split(" ")
                e.cancel()
                Commands.commandList.firstOrNull { it.names.contains(msgSplit[0]) }?.process(msgSplit.drop(1).toTypedArray()) ?: ChatUtil.sendMessageToPlayer("Command not found")
            }
        }
    }

}