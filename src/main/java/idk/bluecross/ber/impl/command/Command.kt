package idk.bluecross.ber.impl.command

import idk.bluecross.ber.api.command.ICommand
import idk.bluecross.ber.util.ChatUtil

abstract class Command(vararg val names: String, val subCommands: ArrayList<Command> = arrayListOf()) : ICommand {

    abstract fun job(args: Array<String>)
    abstract val helpMessage: String

    override fun process(args: Array<String>) {
        try {
            if (subCommands.isNotEmpty() && args.isNotEmpty()) {
                if (args[0].equals("help", true)) {
                    sendHelpMessage()
                    return
                }
                subCommands.firstOrNull { it.names.contains(args[0]) }?.process(args.drop(1).toTypedArray())
                        ?: job(args)
            } else job(args)
        } catch (e: Exception) {
            ChatUtil.sendMessageToPlayer("Something went wrong: ${e.message}")
            sendHelpMessage()
        }
    }

    fun sendHelpMessage() {
        ChatUtil.sendMessageToPlayer(helpMessage)
    }
}