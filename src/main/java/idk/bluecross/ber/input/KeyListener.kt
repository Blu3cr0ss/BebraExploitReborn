package idk.bluecross.ber.input

import idk.bluecross.ber.api.input.keyboard.IKeyBind
import idk.bluecross.ber.impl.event.InputEvent
import idk.bluecross.ber.util.annotation.annotations.AutoInit
import idk.bluecross.ber.util.interfaces.IEventBusRegistrar
import net.minecraftforge.common.MinecraftForge
import net.minecraftforge.fml.common.eventhandler.SubscribeEvent
import net.minecraftforge.fml.common.gameevent.InputEvent.KeyInputEvent
import org.lwjgl.input.Keyboard

@AutoInit
object KeyListener : IEventBusRegistrar {
    init {
        register()
    }

    @SubscribeEvent
    fun onKeyPress(e: KeyInputEvent) {
        with(Keyboard.getEventKey()) {
            if (Keyboard.isKeyDown(this) && Keyboard.KEY_NONE != this)
                runCatching {
                    MinecraftForge.EVENT_BUS.post(InputEvent.Keyboard(this))
                    IKeyBind.keybinds
                            .filter { it.key == this }
                            .forEach() { it.process() }
                }
        }
    }
}